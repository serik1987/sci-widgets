# sci-livesearch

В первоначальном состоянии виджет представляет собой обычное поле ввода. Однако когда пользователь
начинает вводить в это поле строку, то виджет начинает отправлять HTTP-запрос, содержащий эту самую строку.
После получения результатов поиска открывается список, содержащий эти самые результаты. Пользователь может
выбрать тот или иной результат и завершить тем самым заполнение поля ввода.

Данный элемент является потомком элемента SciExpandableWidget.

Вначале для создания данного виджета надо прописать вот такой HTML-элемент:

```
<sci-livesearch label="Search"></sci-livesearch>
```

Однако затем после осуществления процедуры живого поиска он должен раскрываться вот в такой элемент.

```
<sci-livesearch label="Search">
    <ul>
        <li data-value="1">Результат поиска 1</li>
        <li data-value="2">Результат поиска 2</li>
    </ul>
</sci-livesearch>
```

Для этого важно не только прописать нужный HTML-элемент, но и определить у него свойство onUpdate, который делает
HTTP-запрос, необходимый для осуществления живого поиска.

```
document.querySelector("sci-livesearch").onUpdate = function(value){
    ..... // your update code here
}
```

Эта функция должна возвращать промис. Результаты поиска будут сформированы и автоматически откроются только после
успешного разрешения данного промиса. После завершения выполнения функции onUpdate ничего не произойдёт.

Если Вы не зададите значение поля onUpdate, то любое изменение значения в поле ввода, которое произведёт пользователь,
приведёт к ошибке.

Метод onUpdate запускается только в том случае, если пользователь ввёл непустое значение. Если пользователь
ввёл пустое значение, то метод onUpdate не запускается, а вместо этого происходит очистка результатов поиска.
(Все элементы списка <ul> удаляются, раскрывшийся контент снова закрывается.)

## Атрибуты

### align

Принимает одно из следующих значений:

* left - выровнять текст по левому краю
* center - выровнять текста по центру
* right - выровнять текста по правому краю

### no-autofill

Если этот атрибут выставлен, то нажатие на результат поиска не приведёт к тому, что этот результат будет
встроен в поле ввода.

### placeholder

Плейсхолдер (подсказка, которая вставляется в поле ввода тогда, когда пользователь не ввёл какого-либо значения)

### required

Если этот атрибут выставлен, то при попытке обращения к свойству value пользователь получает сообщение об ошибке
в случае, если 

### value [только чтение]

Значение по-умолчанию. Это значение присваивается полю ввода на момент создания элемента. Оно не приводит к
инициализации функции живого поиска. Для того, чтобы запустить процедуру живого поиска, воспользуйтесь методом search.

## Свойства

### align

Управляет значением атрибута align

### defaultValue [только чтение]

Значение атрибута value

### focused [только чтение]

Возвращает true, если поле ввода находится в фокусе и false в противном случае

### id

Если пользователь нажал на тот или иной элемент списка, то значение этого элемента соответствует значению
атрибута data-value нажатого пользователем элемента списка. Если пользователь изменил поле ввода, то id соответствует
null. id также можно задавать программно.

### input

Возвращает виджет sci-input, который находится внутри виджета sci-livesearch. Любые чекеры, валидаторы и пр.,
которые Вы хотите встроить в sci-livesearch, Вы можете встроить в элемент sci-input. В этом случае они будут
применяться до выполнения процедуры живого поиска: если введённая подстрока не удовлетворяет валидаторам или чекерам,
то живой поиск по ней будет невозможен.

Если Вы хотите, чтобы те или иные валидаторы выполнялись бы уже после выполнения живого поиска, используйте
атрибуты, свойства и методы этого объекта, а не расположенного внутри него объекта input.

### items

Объект класса SciItemList.

Отражает список всех элементов с результатами поиска.

### noAutofill

Если свойство принимает значение true, то нажатин на конкретный результат поиска не приведёт к тому, что этот
результат перенесётся в поле ввода.

### onUpdate

Представляет собой функцию, которая принимает на вход строку поиска, введённую пользователем, после чего должна
производить HTTP-запрос. После инициализации HTTP-запроса данная функция должна возвращать соответствующий ему промис.
После завершения выполнения функции никакого раскрытия списка не происходит. Однако после завершения выполнения промиса
происходит добавление результатов поиска в раскрывающийся список с результатами, а также раскрытие этого списка.

По-умолчанию значение этого свойства равно null. Это означает, что любая попытка изменить строку в поле ввода
приведёт к ошибке.

Метод onUpdate запускается только в том случае, если пользователь ввёл непустое значение. Если пользователь
ввёл пустое значение, то метод onUpdate не запускается, а вместо этого происходит очистка результатов поиска.
(Все элементы списка <ul> удаляются, раскрывшийся контент снова закрывается.)

Метод onUpdate всегда запускается в контексте элемента sci-livesearch. Функция принимает один аргумент:
значение, введённое пользователем на момент запуска процедуры живого поиска. Результатом выполнения данного метода
может быть только промис.

Если промис разрешается массивом (объектом класса Array), то на каждый элемент массива создаётся объект класса
SciItem в соответствии со следующими правилами:
0. Каждому объекту массива соответствует свой объект класса SciItem, свойство value которого соответствует
строковому представлению свойства value исходного объекта, а свойство text которого соответствует исходному
представлению свойства text исходного объекта.
1. Если элемент массива содержит свойство description и его значением является строка, то ему соответствует 
объект класса SciDoubleItem. В противном случае переход к п. 2 
2. Если предыдущее условие не выполняется, но объект содержит свойство optional, которое преобразуется в true, то
то данному объекту соответствует объект класса SciOptionalItem. В противном случае переход к п. 3.
3. Если п.п. 1, 2 не выполняются, то ставится в соотвествие объект класса SciItem.

Промис также может разрешаться объектом класса SciItemList. В этом случае этот элемент встраивается в виджет, приводя
к изменению результатов поиска.

Если промис не разрешается ни объектом класса Array, ни объектом класса SciItemList, то никаких манипуляций с
результатами поиска не производится после разрешения промиса. Иными словами, вывод результатов поиска должен
осуществляться в процессе разрешения поиска, иначе результаты поиска обновляться не будут.

Если промис отклоняется, то результаты поиска в любом случае закрываются и очищаются. При этом пользователю
выводится сообщение об ошибке. Отклонение промиса не приводит к формированию исключения.

### placeholder

Управляет значением атрибута placeholder

### required

Если это свойство принимает значение true, то доступ к свойству value приводит в формированию исключения типа
TypeError в том случае, если пользователь не выбрал нужный элемент из списка. Пользователю в этом случае выводится
сообщение об ошибке.

### text

Данные свойство идентично свойству value. Различие заключается только в том, что свойству value Вы не сможете
присвоить значение, а присваивание значения свойству text автоматически изменяет значение свойства value, свойства
input.value.

Изменение значения свойства text не запускает процедуру живого поиска. Для запуска процедуры живого поиска
воспользуйтесь методом search.

### value

Значение, которое ввёл пользователь в поле ввода на момент последнего запуска процедуры живого поиска. Обратите
внимание, что, в отличие от этого значение, свойство input.value (то есть, свойство value объекта input) отражает
введённое пользователем значение на текущий момент времени.

Присваивание значения этому свойству возможно, но оно не приводит ни к какому эффекту. Если Вы хотите изменить
значение поля ввода, воспользуйтесь свойством input.value, методом search, либо свойством text.

## Методы

### addValidator(validator, message)

Добавляет валидатор. Если Вы добавите валидатор, то при обращении к свойству value значение будет пропущено через
валидатор. Если значение пройдёт через валидатор, то оно вернётся в качестве значения value. Если же значение
не пройдёт через валидатор, то пользователю отобразится сообщение, указанное в строке message, а Вы получите
исключение типа TypeError.

В качестве validator может присутствовать регулярное выражение или функция. Если Вы укажите функцию, она будет
принимать ровно один аргумент - введённое пользователем значение, возвращать true в случае, если это значение
прошло через валидатор и false в противном случае.

Отличие данного метода от метода input.addValidator заключается в том, что метод input.addValidator добавляет
валидаторы, которые применяются до выполнения живого поиска, а данный метод применяет валидаторы уже после того,
когда живой поиск был осуществлён.

Метод возвращает ID валидатора, который Вы затем можете подстваить в качестве аргумента в метод removeValidator

### removeValidator(id)

Удаляет валидатор. В качестве аргумента надо указать результат выполнения функции addValidator для данного
конкретного валидатора.

### search(value, autoopen = true)

Принудительно запускает процедуру живого поиска.

value - подстрока для поиска
autoopen - если аргумент принимает значение true, то сразу же после проведения процедуры живого поиска
раскрывается список с результатами поиска. Если аргумент принимает значение false, то такого раскрытия не происходит.
Вне зависимости от значения аргумента autoopen список с результатами поиска не раскрывается в случае, если
поиск не дал результатов.

### updateItems()

Если Вы меняете элементы в раскрывающемся списке напрямую при помощи изменения DOM-структуры, а на с помощью
свойства items, то в конце Ваших манипуляций не забудьте вызвать этот метод.

Если вы меняете элементы при помощи 

## События

### change

Событие генерируется после удачного завершения процедуры живого поиска.